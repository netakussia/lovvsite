<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Love Site</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            max-width: 400px;
            margin: 100px auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #764ba2;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #764ba2;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
            width: auto;
        }

        .admin-content {
            display: none;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            color: white;
            font-weight: 500;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #764ba2;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            margin-bottom: 20px;
            color: #764ba2;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .item-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-title {
            font-weight: 600;
            color: #495057;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .item-content {
            color: #6c757d;
            margin-bottom: 10px;
        }

        .item-meta {
            font-size: 12px;
            color: #adb5bd;
        }

        .password-display {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin-left: 10px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .item-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .item-actions {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginForm" class="login-form">
            <h2>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <form id="loginFormElement">
                <div class="form-group">
                    <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
            </form>
            <div id="loginError" class="error" style="display: none;"></div>
        </div>

        <!-- Admin Content -->
        <div id="adminContent" class="admin-content">
            <div class="header">
                <h1>üíï –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Love Site</h1>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º —Å–∞–π—Ç–∞</p>
                <button id="logoutBtn" class="btn btn-secondary" style="margin-top: 15px; width: auto;">–í—ã–π—Ç–∏</button>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="secret">–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ—Å—Ç—ã</div>
                <div class="tab" data-tab="timeline">–¢–∞–π–º–ª–∞–π–Ω</div>
                <div class="tab" data-tab="gallery">–ì–∞–ª–µ—Ä–µ—è</div>
                <div class="tab" data-tab="temporary">–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</div>
                <div class="tab" data-tab="chat">–ß–∞—Ç</div>
                <div class="tab" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </div>

            <!-- Secret Posts Tab -->
            <div id="secretTab" class="tab-content active">
                <div class="card">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Å—Ç</h3>
                    <form id="secretPostForm">
                        <div class="form-group">
                            <label for="secretTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                            <input type="text" id="secretTitle" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="secretPassword">–ü–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:</label>
                            <input type="text" id="secretPassword" name="password" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ª—é–±–æ–≤—å2025">
                        </div>
                        <div class="form-group">
                            <label for="secretContent">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</label>
                            <textarea id="secretContent" name="content" rows="6" required style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; font-family: inherit;"></textarea>
                        </div>
                        <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Å—Ç</button>
                    </form>
                </div>

                <div class="card">
                    <h3>–°–ø–∏—Å–æ–∫ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</h3>
                    <div id="secretPostsList" class="item-list">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>

            <!-- Timeline Tab -->
            <div id="timelineTab" class="tab-content">
                <div class="card">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç –≤ —Ç–∞–π–º–ª–∞–π–Ω</h3>
                    <form id="postForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="postTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                                <input type="text" id="postTitle" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="postDate">–î–∞—Ç–∞ (–î–î.–ú–ú.–ì–ì–ì–ì):</label>
                                    <input type="text" id="postDate" name="date" placeholder="01.01.2025" required>
                                </div>
                                <div class="form-group">
                                    <label for="postImage">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                                    <input type="text" id="postImage" name="image_url" placeholder="images/photo.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="postContent">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</label>
                            <textarea id="postContent" name="content" rows="3" required style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; font-family: inherit;"></textarea>
                        </div>
                        <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç</button>
                    </form>
                </div>

                <div class="card">
                    <h3>–°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ —Ç–∞–π–º–ª–∞–π–Ω–∞</h3>
                    <div id="postsList" class="item-list">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>

            <!-- Gallery Tab -->
            <div id="galleryTab" class="tab-content">
                <div class="card">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –≤ –≥–∞–ª–µ—Ä–µ—é</h3>
                    <form id="galleryForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="galleryTitle">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                                <input type="text" id="galleryTitle" name="title" placeholder="–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ç–æ" required>
                            </div>
                            <div class="form-group">
                                <label for="galleryType">–¢–∏–ø:</label>
                                <select id="galleryType" name="file_type" required>
                                    <option value="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</option>
                                    <option value="video">–í–∏–¥–µ–æ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="galleryFilePath">–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É:</label>
                            <input type="text" id="galleryFilePath" name="file_path" placeholder="images/photo.jpg" required>
                        </div>
                        <div class="form-group">
                            <label for="galleryThumbnail">–ü—É—Ç—å –∫ –º–∏–Ω–∏–∞—Ç—é—Ä–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <input type="text" id="galleryThumbnail" name="thumbnail_path" placeholder="images/thumb_photo.jpg">
                        </div>
                        <div class="form-group">
                            <label for="galleryDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <textarea id="galleryDescription" name="description" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–ª–∏ –≤–∏–¥–µ–æ..."></textarea>
                        </div>
                        <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –≥–∞–ª–µ—Ä–µ—é</button>
                    </form>
                </div>

                <div class="card">
                    <h3>–≠–ª–µ–º–µ–Ω—Ç—ã –≥–∞–ª–µ—Ä–µ–∏</h3>
                    <div id="galleryList" class="item-list">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>

            <!-- Temporary Messages Tab -->
            <div id="temporaryTab" class="tab-content">
                <div class="card">
                    <h3>–°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
                    <p style="color: #6c757d; margin-bottom: 20px;">–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—á–µ–∑–Ω–µ—Ç</p>
                    <form id="temporaryForm">
                        <div class="form-group">
                            <label for="temporaryTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                            <input type="text" id="temporaryTitle" name="title" placeholder="–°—é—Ä–ø—Ä–∏–∑! üéÅ" required>
                        </div>
                        <div class="form-group">
                            <label for="temporaryContent">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</label>
                            <textarea id="temporaryContent" name="content" rows="4" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..." required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="temporaryShowFrom">–ü–æ–∫–∞–∑–∞—Ç—å —Å:</label>
                                <input type="datetime-local" id="temporaryShowFrom" name="show_from" required>
                            </div>
                            <div class="form-group">
                                <label for="temporaryDuration">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å–æ–≤):</label>
                                <input type="number" id="temporaryDuration" name="duration_hours" min="1" max="168" value="1" required>
                            </div>
                        </div>
                        <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                    </form>
                </div>

                <div class="card">
                    <h3>–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
                    <div id="temporaryList" class="item-list">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>

            <!-- Chat Tab -->
            <div id="chatTab" class="tab-content">
                <div class="card">
                    <h3>–°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞</h3>
                    <p style="color: #6c757d; margin-bottom: 20px;">–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —á–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</p>
                    <form id="chatForm">
                        <div id="chatMessagesContainer">
                            <!-- Messages will be added here dynamically -->
                        </div>
                        <button type="button" id="addMessageBtn" class="btn btn-secondary" style="width: auto; margin-top: 15px;">+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                        <button type="submit" class="btn" style="margin-top: 15px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è</button>
                    </form>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="card">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞</h3>
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="siteTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∞–π—Ç–∞:</label>
                            <input type="text" id="siteTitle" name="site_title" required>
                        </div>
                        <div class="form-group">
                            <label for="siteSubtitle">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∞–π—Ç–∞:</label>
                            <input type="text" id="siteSubtitle" name="site_subtitle" required>
                        </div>
                        <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </form>
                </div>

                <div class="card">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏</h3>
                    <form id="musicForm">
                        <div class="form-group">
                            <label for="musicPage">–°—Ç—Ä–∞–Ω–∏—Ü–∞:</label>
                            <select id="musicPage" name="page" required>
                                <option value="main">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</option>
                                <option value="gallery">–ì–∞–ª–µ—Ä–µ—è</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="musicFile">–§–∞–π–ª –º—É–∑—ã–∫–∏:</label>
                            <input type="text" id="musicFile" name="music_file" placeholder="music/song.mp3">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="musicAutoplay">–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:</label>
                                <input type="checkbox" id="musicAutoplay" name="autoplay">
                            </div>
                            <div class="form-group">
                                <label for="musicLoop">–ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ:</label>
                                <input type="checkbox" id="musicLoop" name="loop" checked>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="musicVolume">–ì—Ä–æ–º–∫–æ—Å—Ç—å (0-1):</label>
                            <input type="number" id="musicVolume" name="volume" min="0" max="1" step="0.1" value="0.5">
                        </div>
                        <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º siteSlug –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        function getSiteSlug() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('site');
        }

        // –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è API —Å —É—á–µ—Ç–æ–º —Å–∞–π—Ç–∞
        function getApiBaseUrl() {
            const siteSlug = getSiteSlug();
            return siteSlug ? `/api/site/${siteSlug}` : '/api';
        }

        let authToken = localStorage.getItem('platformAuthToken');
        let currentEditingId = null;

        // Check if user is already logged in
        if (authToken) {
            // Verify token is still valid
            verifyToken(authToken).then(isValid => {
                if (isValid) {
                    showAdminContent();
                } else {
                    localStorage.removeItem('platformAuthToken');
                    authToken = null;
                    showLoginForm();
                }
            });
        } else {
            showLoginForm();
        }

        // Verify token validity
        async function verifyToken(token) {
            try {
                const response = await fetch('/api/platform/sites', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // Handle authentication errors
        function handleAuthError(response) {
            if (response.status === 403 || response.status === 401) {
                localStorage.removeItem('platformAuthToken');
                authToken = null;
                showLoginForm();
                showError('loginError', '–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.');
                return true;
            }
            return false;
        }

        // Login form
        document.getElementById('loginFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('/api/platform/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('platformAuthToken', authToken);
                    showAdminContent();
                } else {
                    showError('loginError', data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
                }
            } catch (error) {
                showError('loginError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            authToken = null;
            localStorage.removeItem('platformAuthToken');
            showLoginForm();
        });

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
                
                // Load data when switching tabs
                if (tab.dataset.tab === 'secret') {
                    loadSecretPosts();
                } else if (tab.dataset.tab === 'timeline') {
                    loadPosts();
                } else if (tab.dataset.tab === 'gallery') {
                    loadGalleryItems();
                } else if (tab.dataset.tab === 'temporary') {
                    loadTemporaryMessages();
                } else if (tab.dataset.tab === 'chat') {
                    loadChatMessages();
                } else if (tab.dataset.tab === 'settings') {
                    loadSettings();
                }
            });
        });

        // Secret post form
        document.getElementById('secretPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                title: formData.get('title'),
                content: formData.get('content'),
                password: formData.get('password')
            };
            
            try {
                const url = currentEditingId ? `${getApiBaseUrl()}/admin/secret-posts/${currentEditingId}` : `${getApiBaseUrl()}/admin/secret-posts`;
                const method = currentEditingId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    e.target.reset();
                    currentEditingId = null;
                    loadSecretPosts();
                    showSuccess('–°–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                } else {
                    const error = await response.json();
                    showError('secretError', error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('secretError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Post form
        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                title: formData.get('title'),
                date: formData.get('date'),
                image_url: formData.get('image_url'),
                content: formData.get('content')
            };
            
            try {
                const url = currentEditingId ? `${getApiBaseUrl()}/admin/posts/${currentEditingId}` : `${getApiBaseUrl()}/admin/posts`;
                const method = currentEditingId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    e.target.reset();
                    currentEditingId = null;
                    loadPosts();
                    showSuccess('–ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                } else {
                    const error = await response.json();
                    showError('postError', error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('postError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Gallery form
        document.getElementById('galleryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                title: formData.get('title'),
                description: formData.get('description'),
                file_path: formData.get('file_path'),
                file_type: formData.get('file_type'),
                thumbnail_path: formData.get('thumbnail_path')
            };
            
            try {
                const url = currentEditingId ? `${getApiBaseUrl()}/admin/gallery/${currentEditingId}` : `${getApiBaseUrl()}/admin/gallery`;
                const method = currentEditingId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    e.target.reset();
                    currentEditingId = null;
                    loadGalleryItems();
                    showSuccess('–≠–ª–µ–º–µ–Ω—Ç –≥–∞–ª–µ—Ä–µ–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                } else {
                    const error = await response.json();
                    showError('galleryError', error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('galleryError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Temporary message form
        document.getElementById('temporaryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                title: formData.get('title'),
                content: formData.get('content'),
                show_from: formData.get('show_from'),
                duration_hours: parseInt(formData.get('duration_hours'))
            };
            
            try {
                const url = currentEditingId ? `${getApiBaseUrl()}/admin/temporary-messages/${currentEditingId}` : `${getApiBaseUrl()}/admin/temporary-messages`;
                const method = currentEditingId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (handleAuthError(response)) {
                    return;
                }
                
                if (response.ok) {
                    e.target.reset();
                    currentEditingId = null;
                    loadTemporaryMessages();
                    showSuccess('–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
                } else {
                    const error = await response.json();
                    showError('temporaryError', error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('temporaryError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Chat form
        document.getElementById('chatForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const messages = Array.from(document.querySelectorAll('#chatMessagesContainer input')).map(input => input.value).filter(msg => msg.trim());
            
            try {
                const response = await fetch(`${getApiBaseUrl()}/admin/chat-messages`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ messages })
                });
                
                if (response.ok) {
                    showSuccess('–°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                } else {
                    const error = await response.json();
                    showError('chatError', error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('chatError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Music form
        document.getElementById('musicForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                page: formData.get('page'),
                music_file: formData.get('music_file'),
                autoplay: formData.get('autoplay') ? 1 : 0,
                loop: formData.get('loop') ? 1 : 0,
                volume: parseFloat(formData.get('volume'))
            };
            
            try {
                const response = await fetch(`${getApiBaseUrl()}/admin/music/${data.page}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    e.target.reset();
                    showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                } else {
                    const error = await response.json();
                    showError('musicError', error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('musicError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Settings form
        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                site_title: formData.get('site_title'),
                site_subtitle: formData.get('site_subtitle')
            };
            
            try {
                const response = await fetch(`${getApiBaseUrl()}/admin/settings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                } else {
                    const error = await response.json();
                    showError('settingsError', error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('settingsError', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });

        // Add message button
        document.getElementById('addMessageBtn').addEventListener('click', () => {
            addMessageInput('');
        });

        // Helper functions
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }

        function showAdminContent() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            loadSecretPosts();
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 5000);
            }
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('.header'));
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        async function loadSecretPosts() {
            try {
                const response = await fetch(`${getApiBaseUrl()}/admin/secret-posts`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (handleAuthError(response)) {
                    return;
                }
                
                const posts = await response.json();
                
                const container = document.getElementById('secretPostsList');
                container.innerHTML = '';
                
                posts.forEach(post => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-title">${post.title}</div>
                            <div class="item-actions">
                                <button class="btn btn-small" onclick="editSecretPost(${post.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-small btn-danger" onclick="deleteSecretPost(${post.id})">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                        <div class="item-content">–ü–∞—Ä–æ–ª—å: <span class="password-display">${post.password}</span></div>
                        <div class="item-meta">–°–æ–∑–¥–∞–Ω–æ: ${new Date(post.created_at).toLocaleString()}</div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                document.getElementById('secretPostsList').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</div>';
            }
        }

        async function loadPosts() {
            try {
                const response = await fetch(`${getApiBaseUrl()}/posts`);
                const posts = await response.json();
                
                const container = document.getElementById('postsList');
                container.innerHTML = '';
                
                posts.forEach(post => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-title">${post.title} - ${post.date}</div>
                            <div class="item-actions">
                                <button class="btn btn-small" onclick="editPost(${post.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-small btn-danger" onclick="deletePost(${post.id})">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                        <div class="item-content">${post.content}</div>
                        ${post.image_url ? `<div class="item-meta">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${post.image_url}</div>` : ''}
                        <div class="item-meta">–°–æ–∑–¥–∞–Ω–æ: ${new Date(post.created_at).toLocaleString()}</div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                document.getElementById('postsList').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤</div>';
            }
        }

        async function loadGalleryItems() {
            try {
                const response = await fetch(`${getApiBaseUrl()}/admin/gallery`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                const items = await response.json();
                
                const container = document.getElementById('galleryList');
                container.innerHTML = '';
                
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-title">${item.title} (${item.file_type})</div>
                            <div class="item-actions">
                                <button class="btn btn-small" onclick="editGalleryItem(${item.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-small btn-danger" onclick="deleteGalleryItem(${item.id})">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                        <div class="item-content">${item.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                        <div class="item-meta">–§–∞–π–ª: ${item.file_path}</div>
                        ${item.thumbnail_path ? `<div class="item-meta">–ú–∏–Ω–∏–∞—Ç—é—Ä–∞: ${item.thumbnail_path}</div>` : ''}
                        <div class="item-meta">–°–æ–∑–¥–∞–Ω–æ: ${new Date(item.created_at).toLocaleString()}</div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                document.getElementById('galleryList').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏</div>';
            }
        }

        async function loadTemporaryMessages() {
            try {
                const response = await fetch(`${getApiBaseUrl()}/admin/temporary-messages`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (handleAuthError(response)) {
                    return;
                }
                
                const messages = await response.json();
                
                const container = document.getElementById('temporaryList');
                container.innerHTML = '';
                
                messages.forEach(message => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    
                    const showFrom = new Date(message.show_from).toLocaleString();
                    const showUntil = new Date(message.show_until).toLocaleString();
                    const now = new Date();
                    const isActive = message.is_active === 1;
                    const isCurrentlyVisible = isActive && new Date(message.show_from) <= now && new Date(message.show_until) >= now;
                    
                    let statusText = '';
                    if (!isActive) {
                        statusText = '<span style="color: #dc3545;">–ù–µ–∞–∫—Ç–∏–≤–Ω–æ</span>';
                    } else if (isCurrentlyVisible) {
                        statusText = '<span style="color: #28a745;">–ê–∫—Ç–∏–≤–Ω–æ —Å–µ–π—á–∞—Å</span>';
                    } else if (new Date(message.show_from) > now) {
                        statusText = '<span style="color: #ffc107;">–û–∂–∏–¥–∞–µ—Ç</span>';
                    } else {
                        statusText = '<span style="color: #6c757d;">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>';
                    }
                    
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-title">${message.title} ${statusText}</div>
                            <div class="item-actions">
                                <button class="btn btn-small" onclick="editTemporaryMessage(${message.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-small btn-danger" onclick="deleteTemporaryMessage(${message.id})">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                        <div class="item-content">${message.content}</div>
                        <div class="item-meta">–ü–æ–∫–∞–∑–∞—Ç—å —Å: ${showFrom}</div>
                        <div class="item-meta">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${message.duration_hours} —á. (–¥–æ ${showUntil})</div>
                        <div class="item-meta">–°–æ–∑–¥–∞–Ω–æ: ${new Date(message.created_at).toLocaleString()}</div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                document.getElementById('temporaryList').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
            }
        }

        async function loadChatMessages() {
            try {
                const response = await fetch(`${getApiBaseUrl()}/chat-messages`);
                const messages = await response.json();
                
                const container = document.getElementById('chatMessagesContainer');
                container.innerHTML = '';
                
                messages.forEach((message, index) => {
                    addMessageInput(message.message, index);
                });
            } catch (error) {
                document.getElementById('chatMessagesContainer').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
            }
        }

        async function loadSettings() {
            try {
                const response = await fetch(`${getApiBaseUrl()}/settings`);
                const settings = await response.json();
                
                document.getElementById('siteTitle').value = settings.site_title || '';
                document.getElementById('siteSubtitle').value = settings.site_subtitle || '';
                
                // Load music settings
                const musicResponse = await fetch(`${getApiBaseUrl()}/admin/music`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                const musicSettings = await musicResponse.json();
                
                // Set default values for music form
                document.getElementById('musicPage').value = 'main';
                document.getElementById('musicFile').value = '';
                document.getElementById('musicAutoplay').checked = false;
                document.getElementById('musicLoop').checked = true;
                document.getElementById('musicVolume').value = 0.5;
                
                // Load existing music settings if any
                if (musicSettings && musicSettings.length > 0) {
                    const mainSettings = musicSettings.find(s => s.page === 'main');
                    if (mainSettings) {
                        document.getElementById('musicFile').value = mainSettings.music_file || '';
                        document.getElementById('musicAutoplay').checked = mainSettings.autoplay === 1;
                        document.getElementById('musicLoop').checked = mainSettings.loop === 1;
                        document.getElementById('musicVolume').value = mainSettings.volume || 0.5;
                    }
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function addMessageInput(value = '', index = null) {
            const container = document.getElementById('chatMessagesContainer');
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.innerHTML = `
                <input type="text" value="${value}" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="width: calc(100% - 40px); padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <button type="button" onclick="removeMessageInput(this)" style="padding: 8px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">√ó</button>
            `;
            container.appendChild(div);
        }

        function removeMessageInput(button) {
            button.parentElement.remove();
        }

        // Make functions global for onclick handlers
        window.editSecretPost = editSecretPost;
        window.editPost = editPost;
        window.deleteSecretPost = deleteSecretPost;
        window.deletePost = deletePost;
        window.editGalleryItem = editGalleryItem;
        window.deleteGalleryItem = deleteGalleryItem;
        window.editTemporaryMessage = editTemporaryMessage;
        window.deleteTemporaryMessage = deleteTemporaryMessage;
        window.removeMessageInput = removeMessageInput;

        // Placeholder functions for edit/delete operations
        function editSecretPost(id) {
            console.log('Edit secret post:', id);
            // Implementation needed
        }

        function editPost(id) {
            console.log('Edit post:', id);
            // Implementation needed
        }

        function deleteSecretPost(id) {
            console.log('Delete secret post:', id);
            // Implementation needed
        }

        function deletePost(id) {
            console.log('Delete post:', id);
            // Implementation needed
        }

        function editGalleryItem(id) {
            console.log('Edit gallery item:', id);
            // Implementation needed
        }

        function deleteGalleryItem(id) {
            console.log('Delete gallery item:', id);
            // Implementation needed
        }

        function editTemporaryMessage(id) {
            console.log('Edit temporary message:', id);
            // Implementation needed
        }

        function deleteTemporaryMessage(id) {
            console.log('Delete temporary message:', id);
            // Implementation needed
        }
    </script>
</body>
</html>
